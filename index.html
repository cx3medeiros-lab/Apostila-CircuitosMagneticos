<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laborat√≥rio Magn√©tico Animado</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; max-width: 1000px; margin: auto; color: #333; }
        .container-topo { display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-start; }
        .col { flex: 1; min-width: 350px; }
        
        /* Estilo do Canvas da Anima√ß√£o */
        #canvasFluxo { 
            background: #111; 
            border-radius: 12px; 
            width: 100%; 
            max-width: 450px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .controls { background: #f4f7f9; padding: 20px; border-radius: 12px; margin: 20px 0; border: 1px solid #d1d9e0; }
        .result { background: #0D47A1; color: white; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; margin-top: 10px; }
        
        @media print {
            .controls, #canvasFluxo { display: none !important; }
            .img-print { display: block !important; width: 300px; }
        }
        .img-print { display: none; } /* S√≥ aparece na impress√£o se voc√™ quiser manter a est√°tica l√° */
    </style>
</head>
<body>

    <h1>üß≤ M√≥dulo 1: Fluxo Magn√©tico Animado</h1>

    <div class="container-topo">
        <div class="col">
            <h2>Teoria Interativa</h2>
            <p>A For√ßa Magnetomotriz empurra o fluxo pelo n√∫cleo:</p>
            <div style="font-size: 1.6em; text-align: center; margin: 15px 0;">
                \[ \mathcal{F} = \Phi \cdot \mathcal{R} \]
            </div>
            <p>Observe como a velocidade das part√≠culas aumenta com a <b>Corrente</b> e como o fluxo se dispersa no <b>Entreferro</b>.</p>
            
            <div class="controls">
                <label id="labelN">Espiras (N): 500</label>
                <input type="range" id="inputN" min="100" max="1000" value="500" oninput="update()">
                
                <label id="labelI">Corrente (I): 2.0 A</label>
                <input type="range" id="inputI" min="0" max="10" step="0.1" value="2.0" oninput="update()">

                <label id="labelG">Entreferro (g): 1.0 mm</label>
                <input type="range" id="inputG" min="0.1" max="5" step="0.1" value="1.0" oninput="update()">
                
                <div class="result" id="fmmResult">FMM: 1000.0 A.t</div>
            </div>
        </div>

        <div class="col" style="text-align: center;">
            <h3>Simula√ß√£o em Tempo Real</h3>
            <canvas id="canvasFluxo" width="400" height="300"></canvas>
            <p style="font-size: 0.8em; color: #666;">As part√≠culas representam a densidade de fluxo \(B\).</p>
        </div>
    </div>

    <div style="height: 300px; margin-top: 30px;">
        <canvas id="meuGrafico"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('canvasFluxo');
        const ctxAnim = canvas.getContext('2d');
        let particles = [];
        
        // Criar part√≠culas iniciais
        for(let i=0; i<100; i++) {
            particles.push({ t: Math.random() * 1, offset: (Math.random() - 0.5) * 30 });
        }

        function drawCore(gapSize) {
            ctxAnim.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenho do N√∫cleo (Cinza)
            ctxAnim.strokeStyle = "#555";
            ctxAnim.lineWidth = 40;
            ctxAnim.lineJoin = "round";
            
            // Caminho do n√∫cleo com entreferro
            ctxAnim.beginPath();
            ctxAnim.moveTo(100, 50);
            ctxAnim.lineTo(300, 50);
            ctxAnim.lineTo(300, 120); // Topo do gap
            ctxAnim.moveTo(300, 120 + gapSize * 10); // Fundo do gap
            ctxAnim.lineTo(300, 250);
            ctxAnim.lineTo(100, 250);
            ctxAnim.lineTo(100, 50);
            ctxAnim.stroke();

            // Bobina (Cobre)
            ctxAnim.strokeStyle = "#B87333";
            ctxAnim.lineWidth = 15;
            for(let i=0; i<5; i++) {
                ctxAnim.beginPath();
                ctxAnim.moveTo(85, 100 + (i*20));
                ctxAnim.lineTo(115, 110 + (i*20));
                ctxAnim.stroke();
            }
        }

        function animate() {
            const I = parseFloat(document.getElementById('inputI').value);
            const G = parseFloat(document.getElementById('inputG').value);
            const speed = I * 0.02; // Velocidade baseada na corrente
            
            drawCore(G);

            // Part√≠culas de Fluxo
            ctxAnim.fillStyle = `rgba(0, 255, 255, ${Math.min(I/5, 1)})`;
            particles.forEach(p => {
                p.t += speed;
                if (p.t > 1) p.t = 0;

                // L√≥gica de caminho (percorre o ret√¢ngulo)
                let x, y;
                let t = p.t;
                let offset = p.offset;

                if (t < 0.25) { // Topo
                    x = 100 + (t/0.25) * 200; y = 50 + offset;
                } else if (t < 0.5) { // Direita
                    x = 300 + offset; y = 50 + ((t-0.25)/0.25) * 200;
                    // Efeito de espraiamento no gap
                    if (y > 120 && y < 120 + G*10) x += Math.sin((y-120)/(G*10)*Math.PI) * (G*5);
                } else if (t < 0.75) { // Base
                    x = 300 - ((t-0.5)/0.25) * 200; y = 250 + offset;
                } else { // Esquerda
                    x = 100 + offset; y = 250 - ((t-0.75)/0.25) * 200;
                }

                ctxAnim.beginPath();
                ctxAnim.arc(x, y, 2, 0, Math.PI*2);
                ctxAnim.fill();
            });

            requestAnimationFrame(animate);
        }

        // --- Gr√°fico e L√≥gica de C√°lculo ---
        const ctxChart = document.getElementById('meuGrafico').getContext('2d');
        let chart = new Chart(ctxChart, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Fluxo (Wb)', data: [], borderColor: '#1E88E5', fill: true }] },
            options: { responsive: true, maintainAspectRatio: false }
        });

        function update() {
            const N = document.getElementById('inputN').value;
            const I = document.getElementById('inputI').value;
            const G = document.getElementById('inputG').value / 1000;
            
            document.getElementById('labelN').innerText = `Espiras (N): ${N}`;
            document.getElementById('labelI').innerText = `Corrente (I): ${I} A`;
            document.getElementById('labelG').innerText = `Entreferro (g): ${(G*1000).toFixed(1)} mm`;
            
            const fmm = N * I;
            document.getElementById('fmmResult').innerText = `FMM Gerada: ${fmm.toFixed(1)} A.t`;

            let labels = []; let dados = [];
            for (let x = 0.0001; x <= 0.005; x += 0.0005) {
                const fluxo = fmm / ((0.5 / (2000 * 4e-7 * Math.PI * 0.01)) + (x / (4e-7 * Math.PI * 0.01)));
                labels.push(x.toFixed(4)); dados.push(fluxo);
            }
            chart.data.labels = labels; chart.data.datasets[0].data = dados; chart.update();
        }

        update();
        animate();
    </script>
</body>
</html>
